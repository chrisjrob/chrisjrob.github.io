---
layout: post
title: PolarNavy
date: 2013-02-06 13:16:56.000000000 +00:00
type: post
published: true
status: publish
categories:
- linux
- sailing
- technology
tags:
- gps
- polarnavy
meta:
  _edit_last: '20992958'
  tagazine-media: a:7:{s:7:"primary";s:0:"";s:6:"images";a:0:{}s:6:"videos";a:0:{}s:11:"image_count";i:0;s:6:"author";s:8:"20992958";s:7:"blog_id";s:8:"20408733";s:9:"mod_stamp";s:19:"2013-02-06
    10:21:41";}
  publicize_twitter_user: chrisjrob
  _wpas_done_687483: '1'
  _publicize_done_external: a:1:{s:7:"twitter";a:1:{i:122468352;b:1;}}
author:
  login: chrisjrob
  email: chrisjrob@gmail.com
  display_name: chrisjrob
  first_name: ''
  last_name: ''
---
<p>Following <a href="/2012/09/17/gps-on-linux/" title="GPS on Linux">an earlier post on using GPS</a> under Ubuntu, I have been trying to get <a href="http://www.polarnavy.com/" title="Polar Navy">PolarNavy</a> working under Ubuntu 12.10. Polar Navy is the only Linux chart navigation software available for Linux. I know people will correct me by quoting <a href="http://opencpn.org/" title="OpenCPN">OpenCPN</a>, but there are no charts currently legally available for the UK, at least that I could find.</p>
<p>Polar Navy has two components - PolarCOM which communicates with the GPS receiver, and PolarView which displays the actual charts. The two applications can connect together, to show the vessel's current position.</p>
<p>I had Polar Navy working fine under Ubuntu 12.04 i386, but for some reason I had problems running under Ubuntu 12.10 amd64. The problem was that PolarCOM would simply not display the position, i.e. the Lat and Long. I tried running from the command line, and there were a large number of errors when running PolarCOM, for example:<br />
<!--more--></p>
<p><code><br />
`menu_proxy_module_load': ./PolarCOM.bin: undefined symbol: menu_proxy_module_load<br />
(PolarCOM.bin:4487): Gtk-WARNING **: Failed to load type module: (null)<br />
</code></p>
<p>I eventually fixed that by adding the following to the /opt/polarcom/bin/PolarCOM script:</p>
<p><code><br />
export UBUNTU_MENUPROXY=0<br />
</code></p>
<p>Sadly PolarCOM was still not working. The GPS Receiver that I use is the BU-353, a terrific piece of hardware that "just works" under Linux. This is the recommended GPS for Polar Navy, which was a happy coincidence. When I plugged in the receiver it was detected as /dev/ttyUSB0, which I noticed had a group "dialout". I added myself to that group:</p>
<p><code>$ sudo adduser dialout</code></p>
<p>I posted <a href="http://support.polarnavy.com/forum/read.php?1,494" title="PolarNavy support">a request for help</a> on the Polar Navy forums and they suggested I connect directly to the receiver using screen.  I was unsure how to terminate that session, but ended up killing the screen session (Ctrl+Alt+a followed by k to kill). There is probably a better way - feel free to comment below.:</p>
<p><code><br />
$ screen /dev/ttyUSB0 4800<br />
</code></p>
<p>But doing so just output a load of binary garbage, which I realised (with help from Surrey LUG IRC #surrey on irc.lug.org.uk) meant that the receiver was no longer in NMEA mode. Apparently GPSD automatically reconfigures the receiver to SIRC III binary. I have no idea why this was not a problem in Ubuntu 12.04.</p>
<p>To fix this problem I needed to ensure that GPSD was not running. Unfortunately stopping the service does not seem to terminate the process, so I also had to kill it off:</p>
<p><code><br />
$ sudo service gpsd stop<br />
$ ps aux | grep gps<br />
$ killall PolarCOM.bin<br />
</code></p>
<p>Next I placed the GPS receiver into NMEA ASCII mode, instead of SIRCIII Binary mode:</p>
<p><code><br />
$ gpsctl -f -n /dev/ttyUSB0<br />
</code></p>
<p>Lastly, you may also need to configure the serial port, although I did not need to do this:</p>
<p><code><br />
$ stty -F /dev/ttyUSB0 ispeed 4800<br />
</code></p>
<p>A quick check to see that we are getting ASCII NMEA sentences, showed that it was working perfectly, with easy to read text output from the receiver.</p>
<p><code><br />
$ screen /dev/ttyUSB0 4800<br />
</code></p>
<p>To prevent GPSD from reconfiguring the receiver again, I then needed to reconfigure it to use read-only mode:</p>
<p><code>$ sudo dpkg-reconfigure gpsd</code></p>
<p>And at the point where it requests switches, I added "-b" (Broken Device Safety Mode), otherwise known as read-only mode.</p>
<p>With trepidation I launched PolarCOM, which immediately showed my current position.</p>
