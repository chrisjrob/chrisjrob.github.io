---
layout: post
title: Fixing KDE3 file associations
date: 2011-03-03 19:01:45.000000000 +00:00
type: post
published: true
status: publish
categories:
- linux
- technology
tags:
- file associations
- kde
- kde3
meta:
  _edit_last: '20992958'
  reddit: a:2:{s:5:"count";s:1:"0";s:4:"time";s:10:"1300097802";}
  _wpas_done_twitter: '1'
  tagazine-media: a:7:{s:7:"primary";s:0:"";s:6:"images";a:0:{}s:6:"videos";a:0:{}s:11:"image_count";s:1:"0";s:6:"author";s:8:"20992958";s:7:"blog_id";s:8:"20408733";s:9:"mod_stamp";s:19:"2011-03-16
    09:15:32";}
author:
  login: chrisjrob
  email: chrisjrob@gmail.com
  display_name: chrisjrob
  first_name: ''
  last_name: ''
---
<p>We have our file associations locked down using KDE Kiosktool, and yet it seems that one of our users has managed to change their file associations, despite them being locked down; which seems to be because the context menu is not locked down, enabling him to take the option to Open With an alternative application and select the checkbox to remember that association in future.  The only way around this would seem to be to disable the context sensitive menu, at a significant cost in functionality.</p>
<p>So now this user's PDFs open in Acrobat Reader <strong>on our Windows server</strong>, instead of using Acrobat Reader on Linux.  That would not in itself cause a problem, except that the Windows server cannot access the location of the temporary location of Kmail attachments.  I could probably fix that, but I don't really want users opening email attachments using Windows applications.</p>
<p>This user cannot access File Associations to fix this problem, as the menu option is removed; so I need to find a way to fix this problem from the command line.<!--more--></p>
<p>In solving this particular problem I discovered the existence of the users' ~/.local/share/application directory, and was able to remove the application shortcut to the PDF and normal functionality was restored, but I thought it would be worth writing up what I have found to be the case.  Some of the following information may be wrong or misleading and please feel free to comment any issues, and I will endeavour to update this page accordingly.</p>
<h2>KDE File Associations</h2>
<p>I have to say that KDE file associations seem hellishly complicated, which is to say that there are so many different locations of files that it is very difficult to work out what is happening.  The three key factors in play seem to be:</p>
<h3>MIME Types</h3>
<p>Mime-types, appear to be stored in:</p>
<ul>
<li>~/.kde/share/mimelnk directories (for each user)</li>
<li>/usr/share/mimelnk</li>
<li>/etc/kde-profile/standard/share/mimelnk (for kiosktool - a symlink back to /usr/share/mimelnk)</li>
</ul>
<p>These look like this:</p>
<pre>$ cat pdf.desktop
[Desktop Entry]
Comment=PDF
DocumentHidden=false
Icon=application-pdf
MimeType=application/pdf
Patterns=*.pdf;*.PDF
Type=MimeType
X-KDE-AutoEmbed=false</pre>
<p>In other words they link the file extension, in this case *.pdf, with the MimeType, in this case "application/pdf".  I believe I am right in saying that the users' files take precedence over the global ones.</p>
<h3>Application Shortcuts</h3>
<p>Next up are the application shortcuts, and these also can be in diverse locations:</p>
<ul>
<li>~/.kde/share/applnk</li>
<li>~/.local/share/applications</li>
<li>/usr/share/applications</li>
<li>/etc/kde-profile/standard/share/applications (for kiosk-tool)</li>
</ul>
<p>As with the mimetypes, the users' copy take precedence over the shared ones.  These application shortcuts define how to run an application, and look something like this:</p>
<pre>$ cat "Adobe Reader 9 PDF Viewer.desktop"
[Desktop Entry]
Comment=
Exec=acroread
GenericName=PDF
ViewerIcon=AdobeReader9
MimeType=
Name=Adobe Reader 9
Path=
StartupNotify=false
Terminal=0
TerminalOptions=
Type=Application
X-KDE-SubstituteUID=false
X-KDE-Username=</pre>
<p>As you can see, this tells the system how to run the application.</p>
<h3>profilerc</h3>
<p>Lastly there needs to be some way of tieing the above two things together, something that tells the system that you use X application shortcut to open Y mime-type, and this appears to be the role of the profilerc files.  As with the other components, there are multiple copies of this file:</p>
<ul>
<li>~/.kde/share/config/profilerc</li>
<li>/etc/kde-profile/standard/share/config/profilerc</li>
</ul>
<p>An extract of this file in respect of my PDF example, looks something like this:</p>
<pre>[application/pdf - 1]
AllowAsDefault=true
Application=Adobe Reader 8 PDF Viewer.desktop
GenericServiceType=Application
Preference=2
ServiceType=application/pdf
[application/pdf - 2]
AllowAsDefault=true
Application=kpdf_part.desktop
GenericServiceType=KParts/ReadOnlyPart
Preference=1
ServiceType=application/pdf
[application/pdf - 3]
AllowAsDefault=true
Application=kde-kpdf.desktop
GenericServiceType=Application
Preference=2
ServiceType=application/pdf</pre>
<p>This shows both the mime-type "application/pdf" and the application shortcut, e.g. "Adobe Reader 8 PDF Viewer.desktop", and gives the different choices for opening the same mimetype.</p>
<p>I have found this exercise to be hugely frustrating, and I hope this information is of use to someone.  As I said earlier, my intention will be to correct this post as I find out more, so please forgive any errors, and if you have the time, please do let me know by commenting below.</p>
