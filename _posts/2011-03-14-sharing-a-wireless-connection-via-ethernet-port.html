---
layout: post
title: Sharing a wireless connection via ethernet port
date: 2011-03-14 17:09:38.000000000 +00:00
type: post
published: true
status: publish
categories:
- debian
- linux
- technology
tags:
- dnsmasq
- iptables
- masquerade
- nat
meta:
  tagazine-media: a:7:{s:7:"primary";s:0:"";s:6:"images";a:0:{}s:6:"videos";a:0:{}s:11:"image_count";s:1:"0";s:6:"author";s:8:"20992958";s:7:"blog_id";s:8:"20408733";s:9:"mod_stamp";s:19:"2011-03-16
    09:13:46";}
  _edit_last: '20992958'
  _wpas_done_twitter: '1'
  reddit: a:2:{s:5:"count";s:1:"0";s:4:"time";s:10:"1304390026";}
author:
  login: chrisjrob
  email: chrisjrob@gmail.com
  display_name: chrisjrob
  first_name: ''
  last_name: ''
---
<p>One of the challenges in <a href="/2011/03/13/installing-debian-on-a-thin-client-pc/">Installing Debian on a thin client PC</a> was that the venue had a guest wireless network, but no wired network, and clearly these thin client devices did not have wireless capability.</p>
<p>Mike sorted this out by setting up IP forwarding on his laptop, so that we had a wired network which used his wireless connection as a gateway.  I knew this was technically possible, but I had not actually seen it done before.</p>
<p>So this morning I sought out suggestions from the <a href="http://mailman.lug.org.uk/mailman/listinfo/surrey">Surrey LUG Mailing List</a>, and the following was the end result.<br />
<!--more--><br />
Please note that this solution is as-yet untested by me and involves changing your existing iptables rules - albeit only until you reboot.</p>
<p>Assuming eth0 is your LAN port and wlan0 is your wireless WAN port, and that you have connected your client PC to your host PC with a <a href="http://www.amazon.co.uk/gp/product/B000Q6JQCQ/ref=as_li_ss_tl?ie=UTF8&amp;tag=robsquadnet-21&amp;linkCode=as2&amp;camp=1634&amp;creative=19450&amp;creativeASIN=B000Q6JQCQ">crossover ethernet cable</a> (or perhaps via a <a href="http://www.amazon.co.uk/gp/product/B0000E5SEQ/ref=as_li_ss_tl?ie=UTF8&amp;tag=robsquadnet-21&amp;linkCode=as2&amp;camp=1634&amp;creative=19450&amp;creativeASIN=B0000E5SEQ">dedicated switch</a>), then the following instructions should work:</p>
<h2>On the Laptop</h2>
<p>On the laptop, which is assumed to have a working wireless connection, and a wired connection to the Client PC:</p>
<p>Firstly, you will probably need to set some static IP details:<br />
<code><br />
# ifdown eth0<br />
# ifconfig eth0 192.168.10.1 netmask 255.255.255.0<br />
</code></p>
<p>Next we need to activate IP forwarding, and setup iptables to NAT:<br />
<code><br />
# sysctl -w net.ipv4.ip_forward=1<br />
# iptables -t nat -A POSTROUTING -o wlan0 -j MASQUERADE<br />
</code></p>
<p>The following may be worth trying if the client gets Host Prohibited responses:<br />
<code><br />
# iptables -F FORWARD<br />
# iptables -A FORWARD -j ACCEPT<br />
# iptables -nvL<br />
</code></p>
<h2>DNS and DHCP</h2>
<p>If you plan to do this regularly, then you might consider using dnsmasq to provide a DNS nameserver and DHCP to your client PC.  If you do this, then you should not complete the next section entitled "On the Client PC", which should just pick up its details using DHCP.  This method is particularly handy with a Debian net install.<br />
<code><br />
# apt-get install dnsmasq<br />
# vim /etc/dnsmasq.conf<br />
interface=eth0<br />
dhcp-range=192.168.10.10,192.168.10.19,4h<br />
# /etc/init.d/dnsmasq restart<br />
</code></p>
<h2>On the Client PC</h2>
<p>Do not carry out this section, if you configured dnsmasq above.</p>
<p>On the client PC, which is assumed to have a wired connection to the laptop, all you need do is configure static IP networking and add a working nameserver to /etc/resolv.conf (normally populated via dhcp-client):<br />
<code><br />
$ sudo -i<br />
# ifdown eth0<br />
# ifconfig eth0 192.168.10.10 netmask 255.255.255.0 gateway 192.168.10.1<br />
# echo "nameserver 8.8.8.8" &gt; /etc/resolv.conf<br />
</code></p>
<h2>Finishing up</h2>
<p>When you're finished, you should comment out the lines in <code>/etc/dnsmasq.conf</code> and reboot, and you should be back to normal again.</p>
<p>I am really looking forward to testing this set-up; so in the meantime if you get it working, please do let me know.  Any suggestions for improvement - please do feel free to comment.</p>
